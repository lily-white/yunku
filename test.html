
<!DOCTYPE html>
<!-- Begin Screen component://wechat/widget/WechatScreens.xml#createIbyCardSale -->
<!-- Begin Screen component://wechat/widget/CommonScreens.xml#WechatCommonDecorator -->
<!-- Begin Screen component://wechat/widget/CommonScreens.xml#main-decorator -->
<!-- Begin Template component://wechat/webapp/wechat/includes/headerHead.ftl -->
<html lang="zh-CN" dir="ltr" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="address=no" />
    <meta name="format-detection" content="email=no" />
    <link rel="shortcut icon" href="/images/b2c/images/b2c.ico" />
    <link rel="icon" sizes="196x196" href="/images/b2c/images/b2c.ico" />
    <link rel="apple-touch-icon" sizes="152x152" href="/images/b2c/images/b2c.ico" />
  <title>保养卡销售单</title>
      <link rel="stylesheet" href="css/sm.css?v=20150221112123123" type="text/css"/>
      <link rel="stylesheet" href="css/sm-extend.css?v=20150221112123123" type="text/css"/>
      <link rel="stylesheet" href="css/common.css?v=20150221112123123" type="text/css"/>
  

<meta name="description" content="云库汽车易损件服务平台是国内比较专业的汽车易损件、保养件的网上服务平台，在线销售滤清器、火花塞、灯泡、养护品、刹车片、蓄电池、防冻液等汽配商品，为会员提供保质、高效、诚信的优质服务,让您拥有不一样的网上购物体验! "/>
<meta name="keywords" content="惠保云库、云库、汽配、汽配商城、易损件、汽车配件价格、保养件"/>
</head>
<!-- End Template component://wechat/webapp/wechat/includes/headerHead.ftl -->
<!-- Begin Template component://common/webcommon/includes/openhtmlbody.ftl -->
<body>
<!-- End Template component://common/webcommon/includes/openhtmlbody.ftl -->
<!-- Begin Template component://wechat/webapp/wechat/includes/header.ftl -->
<script type="text/javascript" src="js/zepto.min.js?v=20150221112123123"></script>
<script type="text/javascript" src="js/common.js?v=20150221112123123"></script>
<script type="text/javascript" src="js/sm.js?v=20150221112123123"></script>
<script type="text/javascript" src="js/sm-extend.min.js?v=20150221112123123"></script>

<!-- End Template component://wechat/webapp/wechat/includes/header.ftl -->
<!-- Begin Template component://wechat/webapp/wechat/includes/messages.ftl -->



<script>
</script>
<!-- End Template component://wechat/webapp/wechat/includes/messages.ftl -->
<!-- Begin Section Widget  -->
<!-- Begin Template component://wechat/webapp/wechat/page/createIbyCardSale.ftl -->
<div class="page-group cardform">
    <div class="page page-current">
        <header class="bar bar-nav title-bar">
            <a href="javascript:history.go(-1);" class="icon pull-left">&lt;</a>
            <h1 class="title">新增保养卡</h1>
        </header>
        <div class="content">
            <form name="ibyCardForm" id="ibyCardForm" method="post" action="/wechat/control/doCreateIbyCardSale">
            <input  type="hidden" name="carModel" id="carModel" value="" />
            <div class="list-block">
                <ul>
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">VIN码：</div>
                        <div class="item-input">
                          <input id="vinCode" name="vinCode" type="text" maxlength="17" >
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">车型：</div>
                        <div class="item-input">
                          <input id="autoCar" name="autoCar" type="text" readonly="">
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">保养卡：</div>
                        <div class="item-input">
                          <input  type="text" id="maintenanceDisplay" readonly="">
                          <input name="maintenance" type="hidden" id="maintenance">
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">车牌号：</div>
                        <div class="item-input">
                          <input id="plateNumber" name="plateNumber" type="text">
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">车主姓名：</div>
                        <div class="item-input">
                          <input id="ownerName" name="ownerName" type="text">
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">手机号：</div>
                        <div class="item-input">
                          <input id="phoneNumber" name="phoneNumber" type="tel">
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">身份证号：</div>
                        <div class="item-input">
                          <input id="IdCardNumber" name="IdCardNumber" type="text">
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">地址：</div>
                        <div class="item-input">
                          <input id="address" name="address" type="text">
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">保证金金额：</div>
                        <div class="item-input">
                          <input id="deposit" name="deposit" type="text" readonly="">
                        </div>
                      </div>
                    </div>
                  </li>
                   <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">原保险公司：</div>
                        <div class="item-input">
                          <input type="text" name="insuranceCompanyPrimary" id="company-input" readonly>
                        </div>
                      </div>
                    </div>
                  </li>
                   <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">上年保费：</div>
                        <div class="item-input">
                          <input id="insuranceFeeLastYear" name="insuranceFeeLastYear" type="text">
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">保单到期日：</div>
                        <div class="item-input">
                          <input type="text" id="dueDate" name="dueDate" id="date-input" data-toggle='date' >
                        </div>
                      </div>
                    </div>
                  </li>
                   <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title label">备注：</div>
                        <div class="item-input">
                          <input name="description" type="text">
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
            </div>
            </form>
            <div class="btn-block">
              <input type="button" id="subBtn" class="button button-big button-fill" value="保存">
            </div>
        </div>
    </div>
    
    <div class="panel-overlay"></div>
    <!-- 侧滑车型 -->
    <div class="panel panel-right panel-cover" id='panel-type'>
      <div class="content-block vin">
      </div>

    </div>
</div>


<script type="text/javascript">
    $.init();
    
    $(function (){
        
        $("#autoCar").click(function(){
            $.get("test1.html", function (data){
                $("#panel-type .content-block").html(data);
                $.openPanel("#panel-type");
            });
        });
        $('.panel').on("closed",function(){
            if($("#carModel").val()!=''){
                xuanpeicard();
            }
        });
        

       $("#company-input").picker({
            toolbarTemplate: '<header class="bar bar-nav">\
            <button class="button button-link pull-right close-picker">确定</button>\
            <h1 class="title">原保险公司</h1>\
            </header>',
            cols: [
                {
                  textAlign: 'center',
                  values: ['中国人保财险', '中国平安财险', '太平洋财险','中国人寿财险', '中华联合财险', '大地保险','阳光保险', '中国太平财险', '天安保险','其他']
                }
            ],
            onClose:function(){
                $("#company-input-error").remove();
            }
        });
        
        $("#subBtn").click(function(){
            if(!jQuery("#ibyCardForm").valid()){
                return false;
            }
            if($("#carModel").val()==''){
                alert("请选择车型");
                return false;
            }
            var vflag = true;
            $.ajax({
                url: "/wechat/control/isIbyCardRepeatInStore",
                async: false,
                type: 'POST',
                data:  { plateNumber: $('#plateNumber').val() ,ibyCardSaleId:$("#ibyCardSaleId").val()},
                success: function(data) {
                    if(data.responseMessage=="error"){
                        $.alert(data.errorMessage);
                        vflag = false;
                    }
                    
                }
            });
            if(!vflag){
                return false;
            }
            var me = $(this);
            if(isRepeat(me)) return;
            me.prop("repeat", true);
            $.ajax({
                url: "/wechat/control/doCreateIbyCardSaleAjax",
                async: false,
                type: 'POST',
                dataType:"json",
                data:  $("#ibyCardForm").serialize(),
                success: function(data) {
                    if(data.responseMessage=="success"){
                        $.alert("创建成功！");
                        window.location.href="/wechat/control/ibyCardSaleList"
                    }else{
                        $.alert(data.errorMessage);
                    }
                    
                },
                error: function(){
                    $.alert("请先登录再操作");
                },
                complete: function (xhr, status){
                    me.prop("repeat", false);
                }
            });
            
        });
        
        
       
        
    });
    
    function xuanpeicard(){
        var carModel = $('#carModel').val();
        if(carModel == ""){
            alert("请先选择车型");
            return false;
        }
        
        var url = '/wechat/control/getIbyCardByIbyCarSeries';
        $.ajax({
            url: url,
            async: false,
            type: 'POST',
            data:  { carModel: carModel },
            success: function(data) {
                if(data.length>0){
                    $.each(data, function(i,item){
                        if(i==0){
                            $("#maintenance").val(item.productId);
                            $("#maintenanceDisplay").val(item.productName);
                            $("#deposit").val(item.price);
                        }
                    });
                }else{
                    $("#maintenanceDisplay").val("没有匹配的保养卡");
                    $("#maintenance").val("");
                    $("#deposit").val("");
                }
            }
        });
        
    }

</script><!-- End Template component://wechat/webapp/wechat/page/createIbyCardSale.ftl -->
<!-- End Section Widget  -->
<!-- Begin Template component://wechat/webapp/wechat/includes/footer.ftl -->
<script>
</script> <!-- End Template component://wechat/webapp/wechat/includes/footer.ftl -->
<!-- Begin Template component://common/webcommon/includes/closehtmlbody.ftl -->
</body>
</html>
<!-- End Template component://common/webcommon/includes/closehtmlbody.ftl -->
<!-- End Screen component://wechat/widget/CommonScreens.xml#main-decorator -->
<!-- End Screen component://wechat/widget/CommonScreens.xml#WechatCommonDecorator -->
<!-- End Screen component://wechat/widget/WechatScreens.xml#createIbyCardSale -->
